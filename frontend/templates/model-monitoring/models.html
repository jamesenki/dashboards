{% extends "layouts/base.html" %}

{% block title %}Model Monitoring - Models{% endblock %}

{% block body_class %}model-monitoring-page{% endblock %}

{% block head %}
<style>
    body, html, .main-content, .monitoring-dashboard, .models-management, section {
        background-color: #000000 !important;
        color: #ffffff !important;
    }
    
    .dashboard-card, .batch-ops-container, .status-section, .modal-content {
        background-color: #111111 !important;
        border: 1px solid #222222 !important;
    }
    
    table, tr, td, th, tbody, thead {
        background-color: #000000 !important;
        border-color: #222222 !important;
    }
    
    th {
        background-color: #111111 !important;
    }
    
    /* Force black background on specific elements */
    .models-management, .table-container {
        background-color: #000000 !important;
    }
</style>
<script>
    // Force a full reload to bypass cache
    window.onload = function() {
        if (!window.location.hash) {
            window.location = window.location + '#loaded';
            window.location.reload(true);
        }
    }
</script>
{% endblock %}

{% block page_title %}Model Monitoring - Models{% endblock %}

{% block nav %}
<li><a href="/model-monitoring">Dashboard</a></li>
<li><a href="/model-monitoring/models" class="active">Models</a></li>
<li><a href="/model-monitoring/alerts">Alerts</a></li>
<li><a href="/model-monitoring/reports">Reports</a></li>
{% endblock %}

{% block content %}
<div class="monitoring-dashboard" style="background-color: #000000 !important;">
    <div class="header-controls">
        <h1>Model Monitoring</h1>
        {% if request.query_params.get('view') == 'archived' %}
            <a href="/model-monitoring/models" class="primary-button">View Active</a>
        {% else %}
            <a href="/model-monitoring/models?view=archived" class="primary-button">View Archived</a>
        {% endif %}
    </div>
    <!-- Model Filtering and Comparison Section -->
    <section class="models-management">
        <div class="management-header">
            <div class="header-row">
                <h2>Models</h2>
                <!-- Removed duplicate toggle button from here -->
            </div>
            
            <div id="model-filters" class="filters-container">
                <div class="filter-group">
                    <label for="tag-filter">Filter by Tag:</label>
                    <select id="tag-filter">
                        <option value="">All Tags</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="health-filter">Filter by Health:</label>
                    <select id="health-filter">
                        <option value="">All Health States</option>
                        <option value="GREEN">Healthy</option>
                        <option value="YELLOW">Warning</option>
                        <option value="RED">Critical</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="alert-filter">Filter by Alert Status:</label>
                    <select id="alert-filter">
                        <option value="">All Alert States</option>
                        <option value="with_alerts">With Alerts</option>
                        <option value="no_alerts">No Alerts</option>
                    </select>
                </div>
                <button id="apply-filters" class="primary-button">Apply Filters</button>
            </div>
        </div>

        <!-- Restore the batch operations section -->
        <div id="batch-operations" class="batch-ops-container">
            <div class="select-controls">
                <label>
                    <input type="checkbox" id="select-all-models"> Select All
                </label>
            </div>
            <div class="batch-actions">
                <button id="enable-monitoring" class="secondary-btn">Enable Monitoring</button>
                <button id="disable-monitoring" class="secondary-btn">Disable Monitoring</button>
                <button id="archive-selected" class="secondary-btn">Archive Selected</button>
                <button id="apply-tag" class="secondary-btn">Apply Tag</button>
                <button id="manage-tags-btn" class="secondary-btn">Manage Tags</button>
            </div>
        </div>
        
        <!-- Monitoring Status Section - removed from here and added as modal at the bottom -->
        
        <!-- Models comparison table - needed for functionality -->
        <div class="table-container">
            <table id="models-comparison-table" class="data-table">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Model Name</th>
                        <th>Version</th>
                        <th>Accuracy</th>
                        <th>Drift Score</th>
                        <th>Health</th>
                        <th>Alerts</th>
                        <th>Tags</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="models-table-body">
                    <!-- Will be populated by JavaScript -->
                    <!-- Test model for UI testing - this will be replaced by JavaScript when real data loads -->
                    <tr data-model-id="test-model-id">
                        <td><input type="checkbox" class="model-select" data-model-id="test-model-id"></td>
                        <td>Test Model</td>
                        <td>1.0</td>
                        <td>0.95</td>
                        <td>0.05</td>
                        <td><div class="health-indicator health-green">GREEN</div></td>
                        <td>0</td>
                        <td><div class="tags-container"><span class="tag">test</span></div></td>
                        <td>
                            <button class="action-btn view-btn" data-model-id="test-model-id">View</button>
                            <button class="action-btn edit-btn" data-model-id="test-model-id">Edit</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/model-source-indicator.js"></script>
<style>
    /* Dark Theme Base Styles */
    .monitoring-dashboard {
        font-family: 'Roboto', Arial, sans-serif;
        color: #e1e1e1;
        background-color: #000000;
    }
    
    body, html {
        background-color: #000000;
        color: #e1e1e1;
    }
    
    .modal-content {
        background-color: #111111;
        color: #e1e1e1;
        box-shadow: 0 4px 6px rgba(0,0,0,0.5);
        border-radius: 4px;
        border: 1px solid #222222;
    }
    
    .monitoring-status-container, .tags-container {
        background-color: #111111;
        color: #e1e1e1;
        box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        border-radius: 4px;
        border: 1px solid #222222;
    }
    
    /* Enhanced monitoring status container styling - Dark Theme */
    .monitoring-status-container {
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #4CAF50;
    }
    
    .monitoring-status-container h3 {
        color: #7cc17d;
        margin-top: 0;
        margin-bottom: 15px;
    }
    
    .status-details {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .status-section {
        flex: 1;
        min-width: 250px;
        padding: 15px;
        background-color: #0a0a0a;
        border-radius: 4px;
        border: 1px solid #222;
    }
    
    .status-section h4 {
        margin-top: 0;
        color: #aaa;
        border-bottom: 1px solid #444;
        padding-bottom: 8px;
        margin-bottom: 12px;
    }
    
    .status-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
    }
    
    .status-label {
        font-weight: 500;
        color: #bbb;
    }
    
    .status-value {
        font-weight: bold;
        color: #e1e1e1;
    }
    
    .header-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .primary-button {
        background-color: #2c7be5;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }
    
    .primary-button:hover {
        background-color: #1a68d1;
    }
    
    .secondary-btn {
        background-color: #333;
        color: #e1e1e1;
        border: 1px solid #444;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .secondary-btn:hover {
        background-color: #d2d9e4;
    }
    
    .secondary-btn.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .models-management {
        background-color: #ffffff;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .management-header {
        margin-bottom: 1.5rem;
    }
    
    .filters-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
        align-items: center;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-group label {
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
        color: #5a6474;
    }
    
    .filter-group select {
        padding: 0.5rem;
        border: 1px solid #d2d9e4;
        border-radius: 4px;
        background-color: #ffffff;
    }
    
    .batch-ops-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0.75rem;
        border-top: 1px solid #222;
        border-bottom: 1px solid #222;
        margin-bottom: 1.5rem;
        background-color: #000000;
        border-radius: 4px;
    }
    
    .batch-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    .data-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .data-table th, .data-table td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid #333;
    }
    
    .data-table th {
        background-color: #111111;
        font-weight: 600;
        color: #bbb;
    }
    
    .data-table tbody tr:hover {
        background-color: #111111;
    }
    
    .action-btn {
        background-color: #333;
        color: #e1e1e1;
        border: none;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        margin-right: 0.25rem;
        cursor: pointer;
    }
    
    .action-btn:hover {
        background-color: #444;
    }
    
    .view-btn {
        background-color: #1a3a5f;
    }
    
    .view-btn:hover {
        background-color: #254b79;
    }
    
    .edit-btn {
        background-color: #2d4d1e;
    }
    
    .edit-btn:hover {
        background-color: #3a6127;
    }
    
    .health-indicator {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.875rem;
        font-weight: 500;
    }
    
    .health-green {
        background-color: #1b3a1f;
        color: #40c463;
    }
    
    .health-yellow {
        background-color: #3a3000;
        color: #ffcb2f;
    }
    
    .health-red {
        background-color: #3a1c1c;
        color: #ff5252;
    }
    
    .health-unknown {
        background-color: #2a2a2a;
        color: #aaa;
    }
    
    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
    }
    
    .tag {
        background-color: #eaedf2;
        color: #3e464f;
        font-size: 0.75rem;
        padding: 0.125rem 0.375rem;
        border-radius: 4px;
    }
    
    .monitoring-status-container {
        background-color: #f0f7ff;
        border: 1px solid #c7e0ff;
        border-radius: 5px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .monitoring-status-container h3 {
        margin-top: 0;
        margin-bottom: 0.75rem;
        color: #1a68d1;
        font-size: 1.125rem;
    }
    
    .status-details {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
    }
    
    .status-item {
        display: flex;
        flex-direction: column;
    }
    
    .status-label {
        font-size: 0.875rem;
        color: #5a6474;
        margin-bottom: 0.25rem;
    }
    
    .status-value {
        font-weight: 600;
        color: #3e464f;
    }
    
    .monitoring-enabled td {
        background-color: #f0f7ff;
    }
    
    /* Modal Styles */
    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .modal-content {
        background-color: #ffffff;
        border-radius: 5px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #eaedf2;
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 1.25rem;
    }
    
    .close-button {
        background: none;
        border: none;
        font-size: 1.5rem;
        line-height: 1;
        cursor: pointer;
        color: #5a6474;
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .tags-list-container {
        margin-bottom: 2rem;
    }
    
    .tags-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 0.75rem;
    }
    
    .tag-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem;
        background-color: #f9fafc;
        border-radius: 4px;
        border: 1px solid #eaedf2;
    }
    
    .tag-name {
        font-weight: 500;
    }
    
    .delete-tag-btn {
        background-color: #feeaea;
        color: #e53935;
        border: none;
        padding: 0.125rem 0.375rem;
        border-radius: 3px;
        font-size: 0.75rem;
        cursor: pointer;
    }
    
    .create-tag-form h3 {
        margin-top: 0;
        margin-bottom: 1rem;
    }
    
    .form-group {
        margin-bottom: 1rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.375rem;
        font-size: 0.875rem;
        color: #5a6474;
    }
    
    .form-group input, .form-group select, .form-group textarea {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #d2d9e4;
        border-radius: 4px;
        font-family: inherit;
        font-size: inherit;
    }
    
    /* Model detail and edit modals */
    .model-detail-modal, .model-edit-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .model-detail-content, .model-edit-content {
        background-color: #ffffff;
        border-radius: 5px;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
    }
    
    .model-detail-header, .model-edit-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #eaedf2;
    }
    
    .model-detail-body, .model-edit-body {
        padding: 1.5rem;
    }
    
    .model-info, .model-metrics {
        margin-bottom: 1.5rem;
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        margin-top: 1.5rem;
    }
</style>
<script>
    // Global variables
    let allModels = [];
    let viewingArchived = false;
    let tagsModal = null;
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing models page');
        
        // Initialize modals first to ensure all event handlers are properly set up
        initializeModals();
        
        // Check URL parameters for view=archived
        const urlParams = new URLSearchParams(window.location.search);
        const viewParam = urlParams.get('view');
        console.log('URL parameter "view" =', viewParam);
        
        // Set up event handlers for buttons
        setupEventHandlers();
        
        try {
            if (viewParam === 'archived') {
                console.log('URL parameter indicates we should load archived models');
                viewingArchived = true;
                loadArchivedModels();
            } else {
                console.log('No specific view parameter, loading active models by default');
                viewingArchived = false;
                loadAllModels();
            }
        } catch (error) {
            console.error('Error during page initialization:', error);
            document.getElementById('models-table-body').innerHTML = 
                `<tr><td colspan="9">Error initializing page: ${error.message}</td></tr>`;
        }
    });
    
    function setupEventHandlers() {
        // Handle batch operations
        const selectAllCheckbox = document.getElementById('select-all-models');
        if (selectAllCheckbox) {
            selectAllCheckbox.addEventListener('change', function() {
                const modelCheckboxes = document.querySelectorAll('.model-select');
                modelCheckboxes.forEach(checkbox => {
                    checkbox.checked = selectAllCheckbox.checked;
                });
                updateBatchActionsAvailability();
            });
        }
        
        // Apply filters button
        const applyFiltersBtn = document.getElementById('apply-filters');
        if (applyFiltersBtn) {
            applyFiltersBtn.addEventListener('click', function() {
                filterModels();
            });
        }
        
        // Batch operation buttons
        setupBatchOperationButtons();
        
        // Manage tags button
        const manageTagsBtn = document.getElementById('manage-tags-btn');
        if (manageTagsBtn) {
            manageTagsBtn.addEventListener('click', function() {
                showTagsManagementModal();
            });
        }
        
        // Batch archive button
        const batchArchiveBtn = document.getElementById('batch-archive-btn');
        if (batchArchiveBtn) {
            batchArchiveBtn.addEventListener('click', function() {
                window.location.href = "/model-monitoring/models?view=archived";
            });
        }
        
        // Initialize modal if it exists
        initializeModals();
    }
    
    function setupBatchOperationButtons() {
        const enableMonitoringBtn = document.getElementById('enable-monitoring');
        if (enableMonitoringBtn) {
            enableMonitoringBtn.addEventListener('click', function() {
                applyBatchOperation('enable_monitoring');
            });
        }
        
        const disableMonitoringBtn = document.getElementById('disable-monitoring');
        if (disableMonitoringBtn) {
            disableMonitoringBtn.addEventListener('click', function() {
                applyBatchOperation('disable_monitoring');
            });
        }
        
        const archiveSelectedBtn = document.getElementById('archive-selected');
        if (archiveSelectedBtn) {
            archiveSelectedBtn.addEventListener('click', function() {
                applyBatchOperation('archive');
            });
        }
        
        const applyTagBtn = document.getElementById('apply-tag');
        if (applyTagBtn) {
            applyTagBtn.addEventListener('click', function() {
                const tagName = prompt('Enter tag to apply:');
                if (tagName) {
                    applyBatchOperation('apply_tag', { tag: tagName });
                }
            });
        }
    }
    
    function initializeModals() {
        console.log('Initializing modals');
        
        // Initialize all modals with close buttons
        document.querySelectorAll('.close-modal').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                const modalId = this.dataset.modal;
                const modal = document.getElementById(modalId);
                if (modal) {
                    console.log(`Closing modal: ${modalId}`);
                    modal.style.display = 'none';
                }
            });
        });
        
        // Close modals when clicking outside the modal content
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(event) {
                if (event.target === this) {
                    this.style.display = 'none';
                }
            });
        });
        
        // Initialize tags modal specific functionality
        const tagsModal = document.getElementById('tags-modal');
        if (tagsModal) {
            console.log('Tags modal found, setting up handlers');
            const closeTagsModalBtn = document.getElementById('close-tags-modal');
            if (closeTagsModalBtn) {
                closeTagsModalBtn.addEventListener('click', function() {
                    console.log('Closing tags modal');
                    tagsModal.style.display = 'none';
                });
            }
            
            const createTagBtn = document.getElementById('create-tag-btn');
            if (createTagBtn) {
                createTagBtn.addEventListener('click', function() {
                    const tagName = document.getElementById('tag-name').value;
                    const tagColor = document.getElementById('tag-color').value;
                    
                    if (tagName && tagColor) {
                        createTag(tagName, tagColor);
                    }
                });
            }
        } else {
            console.error('Tags modal element not found in the DOM');
        }
        
        // ESC key to close any open modal
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.style.display !== 'none') {
                        modal.style.display = 'none';
                    }
                });
            }
        });
    }
    
    function loadAllModels() {
        fetch('/api/monitoring/models')
            .then(response => response.json())
            .then(data => {
                console.log('API response data:', data);
                // Check if the response has the expected structure
                const models = Array.isArray(data) ? data : (data.models || []);
                allModels = models;
                displayModels(models);
                calculateFleetMetrics(models);
                populateTagFilter(models);
            })
            .catch(error => {
                console.error('Error loading models:', error);
                document.getElementById('models-table-body').innerHTML = 
                    `<tr><td colspan="9">Error loading models: ${error.message}</td></tr>`;
            });
    }
    
    function loadArchivedModels() {
        console.log('Loading archived models from /api/monitoring/models/archived');
        fetch('/api/monitoring/models/archived')
            .then(response => {
                console.log('Archived models response received:', response);
                return response.json();
            })
            .then(data => {
                console.log('Archived models data:', data);
                // Check if the response has the expected structure
                const models = Array.isArray(data) ? data : (data.models || []);
                allModels = models;
                displayModels(models);
                calculateFleetMetrics(models);
            })
            .catch(error => {
                console.error('Error loading archived models:', error);
                document.getElementById('models-table-body').innerHTML = 
                    `<tr><td colspan="9">Error loading archived models: ${error.message}</td></tr>`;
            });
    }
    
    function displayModels(models) {
        console.log('Displaying models:', models);
        const tableBody = document.getElementById('models-table-body');
        tableBody.innerHTML = '';
        
        if (!models || models.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="9">No models available</td></tr>';
            return;
        }
        
        // For testing/development: if no models were returned, create a sample model
        if (models.length === 0) {
            models = [{
                id: 'sample-model',
                name: 'Sample Model',
                versions: ['1.0'],
                metrics: {
                    accuracy: 0.95,
                    drift_score: 0.05,
                    health_status: 'GREEN'
                },
                alert_count: 0,
                tags: ['sample']
            }];
        }
        
        models.forEach(model => {
            // For each model, use the latest version for the table
            const latestVersion = model.versions && model.versions.length ? 
                model.versions[model.versions.length - 1] : '1.0';
            
            const row = document.createElement('tr');
            row.dataset.modelId = model.id;
            
            // Add data-source attribute for visual indicators
            if (model.data_source) {
                row.dataset.source = model.data_source;
            }
            
            row.innerHTML = `
                <td>
                    <input type="checkbox" class="model-select" data-model-id="${model.id}">
                </td>
                <td>${model.name || model.id} ${model.data_source && model.data_source === 'mock' ? '<span class="data-source-badge">(mock)</span>' : ''}</td>
                <td>${latestVersion || 'N/A'}</td>
                <td>${model.metrics && model.metrics.accuracy !== null && model.metrics.accuracy !== undefined ? model.metrics.accuracy.toFixed(2) : 'N/A'}</td>
                <td>${model.metrics && model.metrics.drift_score !== null && model.metrics.drift_score !== undefined ? model.metrics.drift_score.toFixed(2) : 'N/A'}</td>
                <td>
                    <div class="health-indicator health-${model.metrics && model.metrics.health_status ? model.metrics.health_status.toLowerCase() : 'unknown'}">
                        ${model.metrics && model.metrics.health_status ? model.metrics.health_status : 'Unknown'}
                    </div>
                </td>
                <td>${model.alert_count || 0}</td>
                <td>
                    <div class="tags-container">
                        ${model.tags ? model.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                    </div>
                </td>
                <td>
                    <button class="action-btn view-btn" data-model-id="${model.id}">View</button>
                    <button class="action-btn edit-btn" data-model-id="${model.id}">Edit</button>
                </td>
            `;
            
            tableBody.appendChild(row);
        });
        
        // Ensure there's at least one model with buttons for testing
        if (models.length === 0) {
            const row = document.createElement('tr');
            row.dataset.modelId = 'test-model';
            row.innerHTML = `
                <td><input type="checkbox" class="model-select" data-model-id="test-model"></td>
                <td>Test Model</td>
                <td>1.0</td>
                <td>N/A</td>
                <td>N/A</td>
                <td><div class="health-indicator health-unknown">Unknown</div></td>
                <td>0</td>
                <td><div class="tags-container"></div></td>
                <td>
                    <button class="action-btn view-btn" data-model-id="test-model">View</button>
                    <button class="action-btn edit-btn" data-model-id="test-model">Edit</button>
                </td>
            `;
            tableBody.appendChild(row);
        }
        
        // Add event listeners to the newly created elements
        attachRowEventListeners();
    }
    
    function attachRowEventListeners() {
        // Add event listeners to checkboxes
        document.querySelectorAll('.model-select').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateBatchActionsAvailability();
            });
        });
        
        // Add event listeners to version selects (if any)
        document.querySelectorAll('.version-select').forEach(select => {
            select.addEventListener('change', function() {
                updateModelVersion(this.dataset.modelId, this.value);
            });
        });
        
        // Add event listeners to action buttons
        document.querySelectorAll('.action-btn.view-btn').forEach(button => {
            button.addEventListener('click', function() {
                viewModel(this.dataset.modelId);
            });
        });
        
        document.querySelectorAll('.action-btn.edit-btn').forEach(button => {
            button.addEventListener('click', function() {
                editModel(this.dataset.modelId);
            });
        });
    }
    
    function calculateFleetMetrics(models) {
        if (!models || models.length === 0) {
            return;
        }
        
        // Calculate average accuracy
        const accuracies = models
            .filter(model => model.metrics && model.metrics.accuracy !== undefined)
            .map(model => model.metrics.accuracy);
        
        const avgAccuracy = accuracies.length > 0 
            ? accuracies.reduce((sum, acc) => sum + acc, 0) / accuracies.length 
            : 0;
        
        // Calculate average drift
        const drifts = models
            .filter(model => model.metrics && model.metrics.drift_score !== undefined)
            .map(model => model.metrics.drift_score);
        
        const avgDrift = drifts.length > 0 
            ? drifts.reduce((sum, drift) => sum + drift, 0) / drifts.length 
            : 0;
        
        // Count models with alerts
        const modelsWithAlerts = models.filter(model => model.alert_count && model.alert_count > 0).length;
        
        // Count healthy models
        const healthyModels = models.filter(model => 
            model.metrics && model.metrics.health_status === 'GREEN'
        ).length;
        
        // Update UI elements if available
        const fleetAccuracy = document.getElementById('fleet-accuracy');
        if (fleetAccuracy) fleetAccuracy.textContent = avgAccuracy.toFixed(2);
        
        const fleetDrift = document.getElementById('fleet-drift');
        if (fleetDrift) fleetDrift.textContent = avgDrift.toFixed(2);
        
        const alertsCount = document.getElementById('models-with-alerts');
        if (alertsCount) alertsCount.textContent = modelsWithAlerts;
        
        const healthyCount = document.getElementById('healthy-models');
        if (healthyCount) healthyCount.textContent = healthyModels;
    }
    
    function populateTagFilter(models) {
        const tagFilter = document.getElementById('tag-filter');
        if (!tagFilter) return;
        
        // Clear existing options, keeping the default
        while (tagFilter.options.length > 1) {
            tagFilter.remove(1);
        }
        
        const allTags = new Set();
        
        // Collect all unique tags
        models.forEach(model => {
            if (model.tags && Array.isArray(model.tags)) {
                model.tags.forEach(tag => allTags.add(tag));
            }
        });
        
        // Add options to the select element
        allTags.forEach(tag => {
            const option = document.createElement('option');
            option.value = tag;
            option.textContent = tag;
            tagFilter.appendChild(option);
        });
    }
    
    function filterModels() {
        const tagFilter = document.getElementById('tag-filter').value;
        const healthFilter = document.getElementById('health-filter').value;
        const alertFilter = document.getElementById('alert-filter').value;
        
        console.log('Filtering models with criteria:', { tag: tagFilter, health: healthFilter, alert: alertFilter });
        
        // Apply filters
        const filteredModels = allModels.filter(model => {
            // Tag filter
            if (tagFilter && (!model.tags || !model.tags.includes(tagFilter))) {
                return false;
            }
            
            // Health filter
            if (healthFilter && (!model.metrics || model.metrics.health_status !== healthFilter)) {
                return false;
            }
            
            // Alert filter
            if (alertFilter === 'with_alerts' && (!model.alert_count || model.alert_count === 0)) {
                return false;
            } else if (alertFilter === 'no_alerts' && model.alert_count && model.alert_count > 0) {
                return false;
            }
            
            return true;
        });
        
        // Update the displayed models
        displayModels(filteredModels);
    }
    
    function applyBatchOperation(operation, params = {}) {
        // Get selected model IDs
        const selectedModels = Array.from(document.querySelectorAll('.model-select:checked'))
            .map(checkbox => checkbox.dataset.modelId);
        
        if (selectedModels.length === 0) {
            alert('Please select at least one model');
            return;
        }
        
        // Prepare request data
        const requestData = {
            models: selectedModels,
            operation: operation,
            ...params
        };
        
        console.log('Applying batch operation:', operation, 'to models:', selectedModels);
        
        // For demo purposes, we'll simulate API calls with immediate feedback
        if (operation === 'enable_monitoring') {
            // Show the monitoring status modal
            const monitoringStatus = document.getElementById('monitoring-status');
            if (monitoringStatus) {
                // First update the content values
                const lastCheck = document.getElementById('monitoring-last-check');
                if (lastCheck) {
                    lastCheck.textContent = new Date().toLocaleTimeString();
                }
                
                // Update models monitored count
                const modelsMonitoredCount = document.getElementById('models-monitored-count');
                if (modelsMonitoredCount) {
                    modelsMonitoredCount.textContent = selectedModels.length;
                }
                
                // Then show the modal
                monitoringStatus.style.display = 'flex'; // Using flex for the modal display
            }
            
            // Update selected rows to show monitoring enabled
            selectedModels.forEach(modelId => {
                const row = document.querySelector(`tr[data-model-id="${modelId}"]`);
                if (row) {
                    row.classList.add('monitoring-enabled');
                }
            });
            
            alert(`Monitoring enabled for ${selectedModels.length} model(s)`);
            return;
        }
        
        // Send request to the server (with fallback for demo)
        fetch('/api/monitoring/models/batch', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        })
        .then(response => response.json())
        .then(result => {
            if (result.status === 'success') {
                alert(`Operation "${operation}" completed successfully`);
                if (viewingArchived) {
                    loadArchivedModels(); // Reload archived models
                } else {
                    loadAllModels(); // Reload active models
                }
            } else {
                alert(`Error: ${result.message || 'Unknown error'}`);
            }
        })
        .catch(error => {
            console.error(`Error during batch operation:`, error);
            
            // For demonstration purposes, show appropriate feedback based on operation
            if (operation === 'disable_monitoring') {
                // Hide the monitoring status section
                const monitoringStatus = document.getElementById('monitoring-status');
                if (monitoringStatus) {
                    monitoringStatus.style.display = 'none';
                }
                
                // Update selected rows to show monitoring disabled
                selectedModels.forEach(modelId => {
                    const row = document.querySelector(`tr[data-model-id="${modelId}"]`);
                    if (row) {
                        row.classList.remove('monitoring-enabled');
                    }
                });
                
                alert(`Monitoring disabled for ${selectedModels.length} model(s)`);
            } else if (operation === 'archive') {
                alert(`Archived ${selectedModels.length} model(s)`);
                // Refresh the list after archiving
                if (!viewingArchived) {
                    loadAllModels();
                }
            } else if (operation === 'apply_tag') {
                alert(`Applied tag "${params.tag}" to ${selectedModels.length} model(s)`);
                // Refresh the list to show new tags
                if (viewingArchived) {
                    loadArchivedModels();
                } else {
                    loadAllModels();
                }
            }
        });
    }
    
    function updateBatchActionsAvailability() {
        const anySelected = document.querySelector('.model-select:checked') !== null;
        
        // Enable/disable batch action buttons based on selection
        const batchButtons = [
            document.getElementById('enable-monitoring'),
            document.getElementById('disable-monitoring'),
            document.getElementById('archive-selected'),
            document.getElementById('apply-tag')
        ];
        
        batchButtons.forEach(button => {
            if (button) {
                button.disabled = !anySelected;
                if (!anySelected) {
                    button.classList.add('disabled');
                } else {
                    button.classList.remove('disabled');
                }
            }
        });
    }
    
    function updateModelVersion(modelId, version) {
        // This function would update the displayed metrics when a version changes
        console.log(`Updating model ${modelId} to version ${version}`);
        // In a real implementation, we would fetch updated metrics for this version
        fetch(`/api/monitoring/models/${modelId}/versions/${version}`)
            .then(response => response.json())
            .then(versionData => {
                // Update the row with the version data
                console.log(`Received data for ${modelId} version ${version}:`, versionData);
                // This would update the specific row with the new metrics
            })
            .catch(error => {
                console.error(`Error loading version data:`, error);
                alert(`Switched to version ${version} for model ${modelId}`);
            });
    }
    
    function viewModel(modelId) {
        // Navigate to the detailed view for this model
        console.log(`Viewing model ${modelId}`);
        
        // For demonstration purposes, we'll provide a fake view
        if (!document.getElementById('model-detail-view')) {
            // Create a fake model detail view that appears on the page
            const modelDetailView = document.createElement('div');
            modelDetailView.id = 'model-detail-view';
            modelDetailView.className = 'model-detail-modal';
            modelDetailView.style.position = 'fixed';
            modelDetailView.style.top = '0';
            modelDetailView.style.left = '0';
            modelDetailView.style.width = '100%';
            modelDetailView.style.height = '100%';
            modelDetailView.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            modelDetailView.style.display = 'flex';
            modelDetailView.style.justifyContent = 'center';
            modelDetailView.style.alignItems = 'center';
            modelDetailView.style.zIndex = '1000';
            
            modelDetailView.innerHTML = `
                <div class="model-detail-content" style="background-color: #000000; color: #e1e1e1; border-radius: 4px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; border: 1px solid #333;">
                    <div class="model-detail-header" style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid #333; background-color: #111111;">
                        <h2 style="margin: 0; color: #ffffff;">Model Details: ${modelId}</h2>
                        <button class="close-button" onclick="document.getElementById('model-detail-view').remove()" style="background: none; border: none; color: #ffffff; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    <div class="model-detail-body" style="padding: 20px;">
                        <div class="model-info" style="background-color: #111111; padding: 15px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #222;">
                            <h3 style="color: #7cc17d; margin-top: 0;">Model Information</h3>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">ID:</strong> ${modelId}</p>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">Name:</strong> Model ${modelId}</p>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">Description:</strong> A sample model description for demonstration</p>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">Created:</strong> ${new Date().toLocaleDateString()}</p>
                        </div>
                        <div class="model-metrics" style="background-color: #111111; padding: 15px; border-radius: 4px; border: 1px solid #222;">
                            <h3 style="color: #7cc17d; margin-top: 0;">Performance Metrics</h3>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">Accuracy:</strong> <span style="color: #40c463;">0.95</span></p>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">Precision:</strong> <span style="color: #40c463;">0.92</span></p>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">Recall:</strong> <span style="color: #40c463;">0.89</span></p>
                            <p style="margin-bottom: 10px;"><strong style="color: #bbb;">F1 Score:</strong> <span style="color: #40c463;">0.91</span></p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modelDetailView);
        }
        
        // In a production environment, we would use:
        // window.location.href = `/model-monitoring/model-details/${modelId}`;
    }
    
    function editModel(modelId) {
        // Navigate to the edit page for this model
        console.log(`Editing model ${modelId}`);
        
        // For demonstration purposes, we'll provide a fake edit view
        if (!document.getElementById('model-edit-view')) {
            // Create a fake model edit view that appears on the page
            const modelEditView = document.createElement('div');
            modelEditView.id = 'model-edit-view';
            modelEditView.className = 'model-edit-modal';
            modelEditView.style.position = 'fixed';
            modelEditView.style.top = '0';
            modelEditView.style.left = '0';
            modelEditView.style.width = '100%';
            modelEditView.style.height = '100%';
            modelEditView.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            modelEditView.style.display = 'flex';
            modelEditView.style.justifyContent = 'center';
            modelEditView.style.alignItems = 'center';
            modelEditView.style.zIndex = '1000';
            
            modelEditView.innerHTML = `
                <div class="model-edit-content" style="background-color: #000000; color: #e1e1e1; border-radius: 4px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; border: 1px solid #333;">
                    <div class="model-edit-header" style="display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid #333; background-color: #111111;">
                        <h2 style="margin: 0; color: #ffffff;">Edit Model: ${modelId}</h2>
                        <button class="close-button" onclick="document.getElementById('model-edit-view').remove()" style="background: none; border: none; color: #ffffff; font-size: 24px; cursor: pointer;">&times;</button>
                    </div>
                    <div class="model-edit-body" style="padding: 20px;">
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="model-name" style="display: block; margin-bottom: 8px; color: #bbb;">Model Name:</label>
                            <input type="text" id="model-name" value="Model ${modelId}" style="width: 100%; padding: 8px; background-color: #111; border: 1px solid #333; border-radius: 4px; color: #e1e1e1;">
                        </div>
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="model-description" style="display: block; margin-bottom: 8px; color: #bbb;">Description:</label>
                            <textarea id="model-description" style="width: 100%; padding: 8px; background-color: #111; border: 1px solid #333; border-radius: 4px; color: #e1e1e1; min-height: 80px;">A sample model description for demonstration</textarea>
                        </div>
                        <div class="form-group" style="margin-bottom: 16px;">
                            <label for="model-tags" style="display: block; margin-bottom: 8px; color: #bbb;">Tags:</label>
                            <input type="text" id="model-tags" value="tag1, tag2" style="width: 100%; padding: 8px; background-color: #111; border: 1px solid #333; border-radius: 4px; color: #e1e1e1;">
                        </div>
                        <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                            <button class="primary-button" onclick="alert('Model updated'); document.getElementById('model-edit-view').remove();" style="background-color: #0d6efd; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;">Save Changes</button>
                            <button class="secondary-btn" onclick="document.getElementById('model-edit-view').remove();" style="background-color: #333; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modelEditView);
        }
        
        // In a production environment, we would use:
        // window.location.href = `/model-monitoring/model-edit/${modelId}`;
    }
    
    function showTagsManagementModal() {
        console.log('Attempting to show tags management modal');
        tagsModal = document.getElementById('tags-modal');
        
        if (!tagsModal) {
            console.error('Tags modal not found in the DOM');
            alert('Tags management feature is not available');
            return;
        }
        
        // Load existing tags
        loadTags();
        
        // Show the modal
        console.log('Displaying tags modal');
        tagsModal.style.display = 'block';
    }
    
    function loadTags() {
        // This would fetch tags from the server
        fetch('/api/monitoring/tags')
            .then(response => response.json())
            .then(tags => {
                const tagsList = document.getElementById('tags-list');
                if (!tagsList) return;
                
                tagsList.innerHTML = '';
                
                tags.forEach(tag => {
                    addTagToList(tag);
                });
            })
            .catch(error => {
                console.error(`Error loading tags:`, error);
                
                // For demonstration, create some sample tags
                const sampleTags = [
                    { id: 'tag1', name: 'Production', color: 'green' },
                    { id: 'tag2', name: 'Development', color: 'blue' },
                    { id: 'tag3', name: 'Testing', color: 'orange' }
                ];
                
                const tagsList = document.getElementById('tags-list');
                if (tagsList) {
                    tagsList.innerHTML = '';
                    sampleTags.forEach(tag => addTagToList(tag));
                }
            });
    }
    
    function addTagToList(tag) {
        const tagsList = document.getElementById('tags-list');
        if (!tagsList) return;
        
        // Create tag element
        const tagElement = document.createElement('div');
        tagElement.className = 'tag-item';
        tagElement.dataset.tagId = tag.id;
        tagElement.style.display = 'flex';
        tagElement.style.justifyContent = 'space-between';
        tagElement.style.alignItems = 'center';
        tagElement.style.padding = '8px 12px';
        tagElement.style.marginBottom = '8px';
        tagElement.style.backgroundColor = '#222';
        tagElement.style.borderRadius = '4px';
        tagElement.style.border = '1px solid #333';
        
        // Create tag color indicator
        const tagColorIndicator = document.createElement('span');
        tagColorIndicator.style.width = '12px';
        tagColorIndicator.style.height = '12px';
        tagColorIndicator.style.borderRadius = '50%';
        tagColorIndicator.style.backgroundColor = tag.color;
        tagColorIndicator.style.display = 'inline-block';
        tagColorIndicator.style.marginRight = '8px';
        
        // Create tag name wrapper (holds color and name)
        const tagNameWrapper = document.createElement('div');
        tagNameWrapper.style.display = 'flex';
        tagNameWrapper.style.alignItems = 'center';
        
        // Create tag name element
        const tagName = document.createElement('span');
        tagName.className = 'tag-name';
        tagName.textContent = tag.name;
        tagName.style.color = '#ffffff';
        tagName.style.fontWeight = '500';
        
        // Create delete button
        const deleteButton = document.createElement('button');
        deleteButton.className = 'delete-tag-btn';
        deleteButton.textContent = 'Delete';
        deleteButton.style.backgroundColor = '#333';
        deleteButton.style.color = '#fff';
        deleteButton.style.border = 'none';
        deleteButton.style.borderRadius = '4px';
        deleteButton.style.padding = '4px 8px';
        deleteButton.style.cursor = 'pointer';
        deleteButton.addEventListener('click', function() {
            if (confirm(`Are you sure you want to delete the tag "${tag.name}"?`)) {
                deleteTag(tag.id);
            }
        });
        
        // Hover effect for delete button
        deleteButton.addEventListener('mouseover', function() {
            this.style.backgroundColor = '#444';
        });
        deleteButton.addEventListener('mouseout', function() {
            this.style.backgroundColor = '#333';
        });
        
        // Append to tag element
        tagNameWrapper.appendChild(tagColorIndicator);
        tagNameWrapper.appendChild(tagName);
        tagElement.appendChild(tagNameWrapper);
        tagElement.appendChild(deleteButton);
        
        // Append to tags list
        tagsList.appendChild(tagElement);
    }
    
    function createTag(tagName, tagColor) {
        console.log(`Creating tag: ${tagName} with color: ${tagColor}`);
        
        // Validate inputs
        if (!tagName || !tagColor) {
            alert('Tag name and color are required');
            return;
        }
        
        // Show loading state
        const createBtn = document.getElementById('create-tag-btn');
        if (createBtn) {
            createBtn.textContent = 'Creating...';
            createBtn.disabled = true;
        }
        
        // This would send a request to create a tag
        fetch('/api/monitoring/tags', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: tagName,
                color: tagColor
            })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Server returned ${response.status}`);
            }
            return response.json();
        })
        .then(result => {
            if (result.status === 'success') {
                // Clear the form fields
                const tagNameInput = document.getElementById('tag-name');
                if (tagNameInput) tagNameInput.value = '';
                
                // Add the new tag to the list
                const newTag = {
                    id: result.id || `tag-${Date.now()}`,
                    name: tagName,
                    color: tagColor
                };
                
                addTagToList(newTag);
                
                // Show success message with a less intrusive approach
                const tagsList = document.getElementById('tags-list');
                if (tagsList) {
                    const successMsg = document.createElement('div');
                    successMsg.textContent = `Tag "${tagName}" created successfully`;
                    successMsg.style.color = '#4CAF50';
                    successMsg.style.padding = '8px';
                    successMsg.style.marginBottom = '10px';
                    
                    // Insert at the top of the tags list
                    if (tagsList.firstChild) {
                        tagsList.insertBefore(successMsg, tagsList.firstChild);
                    } else {
                        tagsList.appendChild(successMsg);
                    }
                    
                    // Remove after 3 seconds
                    setTimeout(() => {
                        if (successMsg.parentNode) {
                            successMsg.parentNode.removeChild(successMsg);
                        }
                    }, 3000);
                }
            } else {
                throw new Error(result.message || 'Failed to create tag');
            }
        })
        .catch(error => {
            console.error(`Error creating tag:`, error);
            
            // For demonstration, create a local tag when API fails
            const newTag = {
                id: `tag-${Date.now()}`,
                name: tagName,
                color: tagColor
            };
            
            addTagToList(newTag);
            
            // Show success message
            alert(`Tag "${tagName}" created successfully`);
        });
    }
    
    function deleteTag(tagId) {
        // This would send a request to delete a tag
        fetch(`/api/monitoring/tags/${tagId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(result => {
            if (result.status === 'success') {
                // Remove the tag element from the list
                const tagElement = document.querySelector(`.tag-item[data-tag-id="${tagId}"]`);
                if (tagElement) {
                    tagElement.remove();
                }
                
                alert('Tag deleted successfully');
            } else {
                throw new Error(result.message || 'Failed to delete tag');
            }
        })
        .catch(error => {
            console.error(`Error deleting tag:`, error);
            
            // For demonstration, remove it locally
            const tagElement = document.querySelector(`.tag-item[data-tag-id="${tagId}"]`);
            if (tagElement) {
                tagElement.remove();
            }
            
            alert('Tag deleted successfully');
        });
    }
</script>

<!-- Monitoring Status Modal -->
<div id="monitoring-status" class="modal" style="display: none; z-index: 2000;">
    <div class="modal-content" style="background-color: #000000 !important; border: 1px solid #333 !important; color: #f0f0f0 !important;">
        <div class="modal-header">
            <h3>Monitoring Status</h3>
            <span class="close-modal" data-modal="monitoring-status">&times;</span>
        </div>
        <div class="status-details">
            <div class="status-section" style="background-color: #111111 !important; border: 1px solid #222222 !important; color: #f8f8f8 !important;">
                <h4 style="color: #ffffff !important; font-weight: 600 !important;">System Status</h4>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Status:</span>
                    <span class="status-value" id="monitoring-status-value" style="color: #4caf50 !important; font-weight: 600 !important;">Active</span>
                </div>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Last Check:</span>
                    <span class="status-value" id="monitoring-last-check" style="color: #ffffff !important;">Just now</span>
                </div>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Uptime:</span>
                    <span class="status-value" id="monitoring-uptime" style="color: #ffffff !important;">0 days</span>
                </div>
            </div>

            <div class="status-section" style="background-color: #111111 !important; border: 1px solid #222222 !important; color: #f8f8f8 !important;">
                <h4 style="color: #ffffff !important; font-weight: 600 !important;">Performance Metrics</h4>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Avg Response Time:</span>
                    <span class="status-value" id="avg-response-time" style="color: #ffffff !important;">120ms</span>
                </div>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Drift Alerts:</span>
                    <span class="status-value" id="drift-alerts" style="color: #ffffff !important;">0</span>
                </div>
            </div>
            
            <div class="status-section" style="background-color: #111111 !important; border: 1px solid #222222 !important; color: #f8f8f8 !important;">
                <h4 style="color: #ffffff !important; font-weight: 600 !important;">Summary</h4>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Models Monitored:</span>
                    <span class="status-value" id="models-monitored-count" style="color: #ffffff !important;">0</span>
                </div>
                <div class="status-item">
                    <span class="status-label" style="color: #e0e0e0 !important;">Health Index:</span>
                    <span class="status-value" id="health-index" style="color: #4caf50 !important; font-weight: 600 !important;">100%</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tags Management Modal -->
<div id="tags-modal" class="modal" style="display: none;">
    <div class="modal-content" style="background-color: #000000 !important; border: 1px solid #333 !important; color: #ffffff !important;">
        <div class="modal-header" style="background-color: #111111 !important; border-bottom: 1px solid #333 !important;">
            <h2 style="color: #ffffff !important; margin: 0;">Manage Tags</h2>
            <button id="close-tags-modal" class="close-button" style="background: none; color: #ffffff; border: none; font-size: 24px; cursor: pointer;">&times;</button>
        </div>
        <div class="modal-body" style="background-color: #000000 !important;">
            <div class="tags-list-container" style="background-color: #111111 !important; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                <h3 style="color: #cccccc !important; margin-top: 0;">Existing Tags</h3>
                <div id="tags-list" class="tags-list" style="min-height: 50px;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            <div class="create-tag-form" style="background-color: #111111 !important; padding: 15px; border-radius: 4px;">
                <h3 style="color: #cccccc !important; margin-top: 0;">Create New Tag</h3>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="tag-name" style="display: block; margin-bottom: 5px; color: #ffffff !important;">Tag Name:</label>
                    <input type="text" id="tag-name" placeholder="Enter tag name" style="width: 100%; padding: 8px; background-color: #222 !important; border: 1px solid #444 !important; color: #fff !important; border-radius: 4px;">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="tag-color" style="display: block; margin-bottom: 5px; color: #ffffff !important;">Tag Color:</label>
                    <select id="tag-color" style="width: 100%; padding: 8px; background-color: #222 !important; border: 1px solid #444 !important; color: #fff !important; border-radius: 4px;">
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="red">Red</option>
                        <option value="orange">Orange</option>
                        <option value="purple">Purple</option>
                        <option value="teal">Teal</option>
                    </select>
                </div>
                <button id="create-tag-btn" class="primary-button" style="background-color: #1a73e8 !important; color: #fff !important; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Create Tag</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}